<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ã‚ˆã†ã‚Šã‚‡ã†ãã‚“ - å°å…è–¬ç”¨é‡è¨ˆç®—ãƒ„ãƒ¼ãƒ«</title>
    <meta name="description" content="è–¬å‰¤å¸«ã®ãŸã‚ã®å°å…è–¬ç”¨é‡è¨ˆç®—ãƒ„ãƒ¼ãƒ«ã€Œã‚ˆã†ã‚Šã‚‡ã†ãã‚“ã€ã€‚ç°¡å˜ãƒ»æ­£ç¢ºãƒ»å®‰å…¨ã«å°å…ã®æŠ•ä¸é‡ã‚’è¨ˆç®—ã§ãã¾ã™ã€‚">
    <meta name="theme-color" content="#4CAF50">
    <link rel="manifest" href="manifest.json">
    <style>
        /* ãƒ™ãƒ¼ã‚¹ã‚¹ã‚¿ã‚¤ãƒ« */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
            line-height: 1.6;
            color: #333;
            background-color: #f7fafd;
            -webkit-text-size-adjust: 100%;
            -webkit-font-smoothing: antialiased;
        }
        .form-group {
            margin-bottom: 25px;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 20px;
        }
        select, input, button {
            width: 100%;
            height: 60px;
            padding: 16px 20px;
            font-size: 20px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-color: #fff;
            box-sizing: border-box;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 22px;
            padding: 18px 20px;
            margin-top: 10px;
            transition: background-color 0.3s;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
        }
        
        button:active {
            background: #3d8b40;
            transform: translateY(1px);
        }
        button:hover {
            background: #45a049;
        }
        #result {
            margin-top: 25px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #f9f9f9;
            display: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        #result h3 {
            margin-top: 0;
            color: #2c3e50;
            border-bottom: 1px solid #eee;
            padding-bottom: 8px;
        }
        
        h1 {
            text-align: center;
            font-size: 32px;
            font-weight: bold;
            margin: 20px auto 30px auto;
            color: #333;
            width: 100%;
            display: block;
        }
        
        /* ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¿ã‚¤ãƒ« */
        .tab-container {
            display: flex;
            margin-bottom: 30px;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .tab-button {
            flex: 1;
            padding: 15px 10px;
            background: #e0e0e0;
            border: none;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0;
            height: auto;
            border-radius: 0;
        }
        
        .tab-button.active {
            background: #66BB6A;
            color: white;
        }
        
        .tab-button:hover {
            background: #d0d0d0;
        }
        
        .tab-button.active:hover {
            background: #5CAE60;
        }
        
        /* åŠ›ä¾¡è¨ˆç®—ã‚¿ãƒ–ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã®å ´åˆ */
        .tab-button.active.potency-tab {
            background: #BA68C8;
        }
        
        .tab-button.active.potency-tab:hover {
            background: #AB47BC;
        }
        
        /* ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .tab-content {
            display: none;
            min-height: 400px; /* ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®æœ€å°é«˜ã•ã‚’çµ±ä¸€ */
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ä½ç½®çµ±ä¸€ */
        .input-row-1 {
            margin-bottom: 25px;
            min-height: 120px; /* 1è¡Œç›®ã®é«˜ã•ã‚’çµ±ä¸€ */
        }
        
        .input-row-2 {
            margin-bottom: 25px;
            min-height: 80px; /* 2è¡Œç›®ã®é«˜ã•ã‚’çµ±ä¸€ */
        }
        
        /* å°å…ç”¨é‡è¨ˆç®—å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        #dose-calculator input[type="text"],
        #dose-calculator select,
        #dose-calculator .medicine-search-container {
            border: 2px solid #ddd !important;
        }
        
        #dose-calculator input[type="text"]:focus,
        #dose-calculator select:focus {
            outline: none;
            border-color: #66BB6A !important;
            box-shadow: 0 0 0 2px rgba(102, 187, 106, 0.2) !important;
        }
        
        #dose-calculator .medicine-search-container:focus-within {
            border-color: #66BB6A !important;
            box-shadow: 0 0 0 2px rgba(102, 187, 106, 0.2) !important;
        }
        
        #calculateBtn {
            background: #66BB6A !important;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 22px;
            padding: 18px 20px;
            margin-top: 10px;
            transition: background-color 0.3s;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
        }
        
        #calculateBtn:active {
            background: #5CAE60 !important;
            transform: translateY(1px);
        }
        
        #calculateBtn:hover {
            background: #5CAE60 !important;
        }
        
        #result {
            background-color: #E8F5E8 !important;
            border: 1px solid #A5D6A7 !important;
        }
        
        #result h3 {
            color: #388E3C !important;
            border-bottom: 1px solid #A5D6A7 !important;
        }
        
        /* åŠ›ä¾¡è¨ˆç®—å°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        #potency-calculator input[type="text"],
        #potency-calculator select {
            border: 2px solid #ddd !important;
        }
        
        /* æ•°å€¤å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®IMEç„¡åŠ¹åŒ– */
        #concentration,
        #prescribedDose,
        #weight,
        #weightForAge,
        #age {
            ime-mode: disabled !important;
        }
        
        /* è–¬å‰¤æ¤œç´¢ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®IMEã‚«ã‚¿ã‚«ãƒŠè¨­å®š */
        #medicineSearch {
            ime-mode: katakana !important;
        }
        
        #potency-calculator input[type="text"]:focus,
        #potency-calculator select:focus {
            outline: none;
            border-color: #BA68C8 !important;
            box-shadow: 0 0 0 2px rgba(186, 104, 200, 0.2) !important;
        }
        
        #calculatePotencyBtn {
            background: #BA68C8 !important;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            font-size: 22px;
            padding: 18px 20px;
            margin-top: 10px;
            transition: background-color 0.3s;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
        }
        
        #calculatePotencyBtn:active {
            background: #AB47BC !important;
            transform: translateY(1px);
        }
        
        #calculatePotencyBtn:hover {
            background: #AB47BC !important;
        }
        
        #potencyResult {
            background-color: #FCF4FF !important;
            border: 1px solid #E1BEE7 !important;
        }
        
        #potencyResult h3 {
            color: #8E24AA !important;
            border-bottom: 1px solid #E1BEE7 !important;
        }
        
        /* ã‚¹ãƒãƒ›ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        @media screen and (max-width: 480px) {
            body {
                padding: 10px;
                font-size: 16px;
            }
            
            h1 {
                font-size: 28px;
                margin: 15px 0 25px 0;
            }
            
            select, input, button {
                padding: 14px 12px;
                font-size: 16px;
                margin-bottom: 12px;
            }
            
            button {
                padding: 16px;
                font-size: 18px;
            }
            
            .form-group {
                margin-bottom: 20px;
            }
            
            #result {
                padding: 12px;
            }
        }
        
        /* å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        input:focus, select:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }
        
        /* è–¬å‰¤æ¤œç´¢å…¥åŠ›æ¬„ã®ã‚³ãƒ³ãƒ†ãƒŠ */
        .medicine-search-container {
            position: relative;
            display: flex;
            align-items: center;
            width: 100%;
            border: 2px solid #ddd !important;
            border-radius: 8px;
            background-color: #fff;
            box-sizing: border-box;
            height: 60px;
        }
        
        /* å…¥åŠ›æ¬„ã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ */
        .medicine-search-container input {
            border: none !important;
            background: transparent !important;
            padding: 16px 40px 16px 20px !important;
            flex: 1;
            outline: none;
            height: 100%;
            box-sizing: border-box;
            font-size: 20px;
            margin-bottom: 0 !important;
        }
        
        
        /* ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .clear-button {
            position: absolute;
            right: 48px;
            background: none;
            color: #999;
            border: none;
            width: 30px;
            height: 30px;
            font-size: 20px;
            line-height: 1;
            cursor: pointer;
            display: none;
            padding: 0;
            font-weight: bold;
            transition: color 0.2s ease;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
            border-radius: 4px;
        }
        
        .clear-button:hover {
            color: #666;
            background: rgba(0,0,0,0.05);
        }
        
        .clear-button:active {
            color: #333;
            background: rgba(0,0,0,0.1);
        }
        
        /* å…¥åŠ›æ¬„ã«ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚‹æ™‚ã®ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³è¡¨ç¤º */
        .medicine-search-container.has-text .clear-button {
            display: block;
        }
        
        /* éŸ³å£°å…¥åŠ›ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .voice-button {
            position: absolute;
            right: 8px;
            width: 35px;
            height: 35px;
            background: #4CAF50;
            border: none;
            border-radius: 50%;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            -webkit-tap-highlight-color: rgba(0,0,0,0);
        }
        
        .voice-button:hover {
            background: #45a049;
        }
        
        .voice-button:active {
            background: #3d8b40;
            transform: scale(0.95);
        }
        
        .voice-button.recording {
            background: #f44336;
            animation: pulse 1s infinite;
        }
        
        .voice-button.recording:hover {
            background: #d32f2f;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .voice-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        /* é¸æŠãƒœãƒƒã‚¯ã‚¹ã®çŸ¢å°ã‚¹ã‚¿ã‚¤ãƒ« */
        select {
            background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23333%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E");
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 12px auto;
            padding-right: 30px;
        }
        
        
    </style>
</head>
<body>
    <h1>ã‚ˆã†ã‚Šã‚‡ã†ãã‚“</h1>
    
    <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
    <div class="tab-container">
        <button class="tab-button active dose-tab" onclick="switchTab('dose-calculator')">å°å…ç”¨é‡è¨ˆç®—</button>
        <button class="tab-button potency-tab" onclick="switchTab('potency-calculator')">åŠ›ä¾¡è¨ˆç®—</button>
    </div>
    
    <!-- å°å…ç”¨é‡è¨ˆç®—ã‚¿ãƒ– -->
    <div id="dose-calculator" class="tab-content active">
    
    <div class="form-group input-row-1">
        <label for="medicineSearch">ğŸ’Š è–¬å‰¤ã‚’æ¤œç´¢ãƒ»é¸æŠ:</label>
        <div class="medicine-search-container">
            <input type="text" id="medicineSearch" placeholder="è–¬å‰¤åã‚’å…¥åŠ›..." style="ime-mode: katakana;">
            <button type="button" class="clear-button" id="clearMedicineSearch" title="å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢">Ã—</button>
            <button type="button" class="voice-button" id="voiceSearchButton" title="éŸ³å£°å…¥åŠ›">ğŸ¤</button>
        </div>
        <div id="medicineList" style="display: none; border: 1px solid #ddd; border-radius: 5px; background: white; max-height: 200px; overflow-y: auto; margin-top: 5px;"></div>
        <input type="hidden" id="selectedMedicine" name="medicine">
    </div>
    
    <div id="indicationGroup" class="form-group" style="display: none;">
        <label for="indication">é©å¿œç—‡ã‚’é¸æŠ:</label>
        <select id="indication">
            <option value="">-- é©å¿œç—‡ã‚’é¸æŠ --</option>
            <option value="herpesSimplex">å˜ç´”ç–±ç–¹</option>
            <option value="herpesZoster">å¸¯çŠ¶ç–±ç–¹</option>
        </select>
    </div>
    
    <div id="weightGroup" class="form-group input-row-2">
        <label for="weight">ğŸ’ª ä½“é‡ã§ã®è¨ˆç®— (kg):</label>
        <input type="text" id="weight" inputmode="decimal" pattern="[0-9]*\.?[0-9]*" placeholder="ä¾‹: 15.5">
    </div>
    
    <div id="ageGroup" class="form-group" style="display: none;">
        <label for="age">ğŸ‚ å¹´é½¢ã§ã®è¨ˆç®— (æ­³):</label>
        <input type="text" id="age" inputmode="decimal" pattern="[0-9]*\.?[0-9]*" placeholder="ä¾‹: 5 ã¾ãŸã¯ 0.5">
    </div>
    
    <div id="weightGroupForAge" class="form-group" style="display: none;">
        <label for="weightForAge">ğŸ’ª ä½“é‡ (kg):</label>
        <input type="text" id="weightForAge" inputmode="decimal" pattern="[0-9]*\.?[0-9]*" placeholder="ä¾‹: 15.5">
    </div>
    
    <div id="dosageOptionGroup" class="form-group" style="display: none;">
        <label for="dosageOption">ç”¨æ³•ã‚’é¸æŠ:</label>
        <select id="dosageOption">
            <option value="">-- ç”¨æ³•ã‚’é¸æŠ --</option>
        </select>
    </div>
    
    <button id="calculateBtn">è¨ˆç®—ã™ã‚‹</button>
    
    <div id="result">
        <h3>è¨ˆç®—çµæœ</h3>
        <p><strong>è–¬å‰¤å:</strong> <span id="resultMedicine">-</span></p>
        <p style="font-size: 24px; color: #2E7D32; margin: 15px 0;"><strong>1æ—¥é‡ï¼ˆç§¤å–é‡ï¼‰:</strong> <span id="resultDose" style="font-weight: bold; font-size: 26px;">-</span></p>
        <p><strong>1å›é‡:</strong> <span id="resultSingleDose">-</span></p>
        <p><strong>ç”¨æ³•:</strong> <span id="dosageInfo">-</span></p>
        <div id="contraindicationInfo" style="display: none; margin-top: 15px; padding: 10px; background-color: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; color: #856404;">
            <strong>âš ï¸ æ³¨æ„:</strong> <span id="contraindicationText">-</span>
        </div>
    </div>
    
    </div> <!-- å°å…ç”¨é‡è¨ˆç®—ã‚¿ãƒ–çµ‚äº† -->
    
    <!-- åŠ›ä¾¡è¨ˆç®—ã‚¿ãƒ– -->
    <div id="potency-calculator" class="tab-content">
        
        <div class="form-group input-row-1">
            <label for="concentration">ğŸ§ª è–¬å‰¤ã®æ¿ƒåº¦ (%):</label>
            <input type="text" id="concentration" inputmode="decimal" pattern="[0-9]*\.?[0-9]*" placeholder="ä¾‹: 1.0" style="ime-mode: disabled;">
        </div>
        
        <div class="form-group input-row-2">
            <label for="prescribedDose">ğŸ“ å‡¦æ–¹ç®‹è¨˜è¼‰ã®ç”¨é‡:</label>
            <div style="display: flex; gap: 10px; align-items: stretch;">
                <input type="text" id="prescribedDose" inputmode="decimal" pattern="[0-9]*\.?[0-9]*" placeholder="ä¾‹: 50" style="flex: 1; margin-bottom: 0; ime-mode: disabled;">
                <select id="doseUnit" style="flex: 0 0 80px; margin-bottom: 0;">
                    <option value="mg">mg</option>
                    <option value="Î¼g">Î¼g</option>
                </select>
            </div>
        </div>
        
        <button id="calculatePotencyBtn">åŠ›ä¾¡è¨ˆç®—ã™ã‚‹</button>
        
        <div id="potencyResult" style="display: none; margin-top: 25px; padding: 15px; border: 1px solid #e0e0e0; border-radius: 8px; background-color: #f9f9f9; box-shadow: 0 2px 4px rgba(0,0,0,0.05);">
            <h3>åŠ›ä¾¡è¨ˆç®—çµæœ</h3>
            <p><strong>è–¬å‰¤ã®æ¿ƒåº¦:</strong> <span id="resultConcentration">-</span> %</p>
            <p><strong>å‡¦æ–¹ç®‹è¨˜è¼‰ã®ç”¨é‡:</strong> <span id="resultPrescribedDose">-</span> <span id="resultDoseUnit">-</span></p>
            <p style="font-size: 24px; color: #6A1B9A; margin: 15px 0;"><strong>1æ—¥é‡ï¼ˆç§¤å–é‡ï¼‰:</strong> <span id="resultWeighAmount" style="font-weight: bold; font-size: 26px;">-</span> g</p>
        </div>
        
    </div> <!-- åŠ›ä¾¡è¨ˆç®—ã‚¿ãƒ–çµ‚äº† -->

    <script>
        // è–¬å‰¤ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
        const medicines = {
            "acetaminophen": {
                name: "ã‚¢ã‚»ãƒˆã‚¢ãƒŸãƒãƒ•ã‚§ãƒ³DS40%ã€Œä¸‰å’Œã€",
                minDosePerKg: 30,   // mg/kg/æ—¥
                maxDosePerKg: 45,    // mg/kg/æ—¥
                frequency: 3,         // 1æ—¥3å›
                concentration: 0.4    // 40%
            },
            "orapem": {
                name: "ã‚ªãƒ©ãƒšãƒãƒ å°å…ç”¨ç´°ç²’10%",
                dailyDoseMultiplier: 0.08,  // 1æ—¥é‡ = 0.08 Ã— ä½“é‡(kg)
                frequency: 2,                // 1æ—¥2å›
                concentration: 0.1           // 10%
            },
            "ozex": {
                name: "ã‚ªã‚¼ãƒƒã‚¯ã‚¹ç´°ç²’å°å…ç”¨15%",
                minDosePerKg: 12,    // 1æ—¥é‡ 12mg/kg/æ—¥
                maxDosePerKg: 12,    // 1æ—¥é‡ 12mg/kg/æ—¥
                frequency: 2,         // 1æ—¥2å›
                concentration: 0.15   // 15%
            },
            "carnal20": {
                name: "ã‚«ãƒ­ãƒŠãƒ¼ãƒ«ç´°ç²’20%",
                minDosePerKg: 30,    // 1æ—¥é‡ 30-45mg/kg/æ—¥
                maxDosePerKg: 45,
                frequency: 3,         // 1æ—¥3å›
                concentration: 0.2    // 20%
            },
            "carnal50": {
                name: "ã‚«ãƒ­ãƒŠãƒ¼ãƒ«ç´°ç²’50%",
                minDosePerKg: 30,    // 1æ—¥é‡ 30-45mg/kg/æ—¥
                maxDosePerKg: 45,
                frequency: 3,         // 1æ—¥3å›
                concentration: 0.5    // 50%
            },
            "clarith": {
                name: "ã‚¯ãƒ©ãƒªã‚¹DS10%å°å…ç”¨",
                minDosePerKg: 10,   // mg/kg/æ—¥
                maxDosePerKg: 15,    // mg/kg/æ—¥
                frequency: 2,         // 1æ—¥2å›
                concentration: 0.1    // 10%
            },
            "cefzon": {
                name: "ã‚»ãƒ•ã‚¾ãƒ³ç´°ç²’å°å…ç”¨10%",
                minDosePerKg: 9,     // 1æ—¥é‡ 9-18mg/kg/æ—¥
                maxDosePerKg: 18,
                frequency: 3,         // 1æ—¥3å›
                concentration: 0.1    // 10%
            },
            "farom": {
                name: "ãƒ•ã‚¡ãƒ­ãƒ DSå°å…ç”¨10%",
                minDosePerKg: 15,    // 1æ—¥é‡ 15-30mg/kg/æ—¥
                maxDosePerKg: 30,     // 1æ—¥é‡ 15-30mg/kg/æ—¥
                frequency: 3,         // 1æ—¥3å›
                concentration: 0.1    // 10%
            },
            "meiact": {
                name: "ãƒ¡ã‚¤ã‚¢ã‚¯ãƒˆMSå°å…ç”¨ç´°ç²’10%",
                minDosePerKg: 9,    // mg/kg/æ—¥
                maxDosePerKg: 9,     // mg/kg/æ—¥
                frequency: 3,         // 1æ—¥3å›
                concentration: 0.1    // 10%
            },
            "sawacillin": {
                name: "ã‚µãƒ¯ã‚·ãƒªãƒ³ç´°ç²’10%",
                minDosePerKg: 20,    // 1æ—¥é‡ 20-40mg/kg/æ—¥
                maxDosePerKg: 40,     // 1æ—¥é‡ 20-40mg/kg/æ—¥
                frequency: 3,         // 1æ—¥3å›
                concentration: 0.1    // 10%
            },
            "flomox": {
                name: "ãƒ•ãƒ­ãƒ¢ãƒƒã‚¯ã‚¹å°å…ç”¨ç´°ç²’10%",
                minDosePerKg: 9,     // 1æ—¥é‡ 9mg/kg/æ—¥
                maxDosePerKg: 9,      // 1æ—¥é‡ 9mg/kg/æ—¥
                frequency: 3,          // 1æ—¥3å›
                concentration: 0.1     // 10%
            },
            "fosmicin": {
                name: "ãƒ›ã‚¹ãƒŸã‚·ãƒ³DS400",
                minDosePerKg: 40,    // 1æ—¥é‡ 40-120mg/kg/æ—¥
                maxDosePerKg: 120,   // 1æ—¥é‡ 40-120mg/kg/æ—¥
                frequency: 3,        // 1æ—¥3ï½4å›ï¼ˆ3å›ã§è¨ˆç®—ï¼‰
                concentration: 0.4   // 40%
            },
            "widesillin": {
                name: "ãƒ¯ã‚¤ãƒ‰ã‚·ãƒªãƒ³ç´°ç²’20%",
                minDosePerKg: 20,    // 1æ—¥é‡ 20-40mg/kg/æ—¥
                maxDosePerKg: 40,     // 1æ—¥é‡ 20-40mg/kg/æ—¥
                frequency: 3,         // 1æ—¥3å›
                concentration: 0.2    // 20%
            },
            "onon": {
                name: "ã‚ªãƒãƒ³DS10%",
                minDosePerKg: 7,     // 1æ—¥é‡ 7-10mg/kg/æ—¥
                maxDosePerKg: 10,      // 1æ—¥é‡ 7-10mg/kg/æ—¥
                maxDailyDose: 4.5,    // 1æ—¥é‡ã®æœ€å¤§å€¤ 4.5g
                frequency: 2,         // 1æ—¥2å›
                concentration: 0.1    // 10%
            },
            "erythro": {
                name: "ã‚¨ãƒªã‚¹ãƒ­ã‚·ãƒ³DSW20%",
                minDosePerKg: 25,    // 1æ—¥é‡ 25-50mg/kg/æ—¥
                maxDosePerKg: 50,     // 1æ—¥é‡ 25-50mg/kg/æ—¥
                frequency: 4,         // 1æ—¥4å›
                concentration: 0.2    // 20%
            },
            "zovirax": {
                name: "ã‚¾ãƒ“ãƒ©ãƒƒã‚¯ã‚¹é¡†ç²’40%",
                // é©å¿œç—‡ã«ã‚ˆã£ã¦ç•°ãªã‚‹ãŸã‚ã€calculateDoseé–¢æ•°å†…ã§è¨­å®š
                minDosePerKg: 0,     // è¨ˆç®—æ™‚ã«è¨­å®š
                maxDosePerKg: 0,      // è¨ˆç®—æ™‚ã«è¨­å®š
                frequency: 3,         // 1æ—¥3å›ï¼ˆé©å¿œç—‡ã«ã‚ˆã‚‹ï¼‰
                concentration: 0.4,   // 40%
                hasIndication: true   // é©å¿œç—‡ã®é¸æŠãŒå¿…è¦
            },
            "valtrex": {
                name: "ãƒãƒ«ãƒˆãƒ¬ãƒƒã‚¯ã‚¹é¡†ç²’50%",
                // é©å¿œç—‡ã«ã‚ˆã£ã¦ç•°ãªã‚‹ãŸã‚ã€calculateDoseé–¢æ•°å†…ã§è¨­å®š
                minDosePerKg: 0,     // è¨ˆç®—æ™‚ã«è¨­å®š
                maxDosePerKg: 0,      // è¨ˆç®—æ™‚ã«è¨­å®š
                frequency: 3,         // 1æ—¥3å›
                concentration: 0.5,   // 50%
                requiresIndication: true
            },
            "tamiflu": {
                name: "ã‚¿ãƒŸãƒ•ãƒ«DS3%(å¹¼å°å…ã«é™ã‚‹)",
                dailyDosePerKg: 0.133, // 1æ—¥é‡ 0.133g/kg
                maxDailyDose: 5,      // 1æ—¥é‡ã®æœ€å¤§å€¤ 5g
                frequency: 2,         // 1æ—¥2å›
                concentration: 0.03   // 3%
            },
            "allelock": {
                name: "ã‚¢ãƒ¬ãƒ­ãƒƒã‚¯é¡†ç²’0.5%",
                type: "age-based",    // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤
                ageRanges: [
                    { minAge: 2, maxAge: 7, dailyDoseG: 1.0 },    // 2æ­³ä»¥ä¸Š6æ­³æœªæº€ï¼š1æ—¥1g
                    { minAge: 7, maxAge: 15, dailyDoseG: 2.0 }    // 7æ­³ä»¥ä¸Š15æ­³æœªæº€ï¼š1æ—¥2g
                ],
                frequency: 2,         // 1æ—¥2å›ï¼ˆæœãƒ»å°±å¯å‰ï¼‰
                concentration: 0.005, // 0.5%
                requiresAge: true     // å¹´é½¢å…¥åŠ›ãŒå¿…è¦
            },
            "fexofenadine": {
                name: "ãƒ•ã‚§ã‚­ã‚½ãƒ•ã‚§ãƒŠã‚¸ãƒ³å¡©é…¸å¡©DS5%",
                type: "age-based",    // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤
                ageRanges: [
                    { minAge: 0.5, maxAge: 2, dailyDoseG: 0.6 },   // 0.5æ­³ä»¥ä¸Š2æ­³æœªæº€ï¼š1æ—¥0.6g
                    { minAge: 2, maxAge: 12, dailyDoseG: 1.2 },    // 2æ­³ä»¥ä¸Š12æ­³æœªæº€ï¼š1æ—¥1.2g
                    { minAge: 12, maxAge: 15, dailyDoseG: 2.4 }    // 12æ­³ä»¥ä¸Š15æ­³æœªæº€ï¼š1æ—¥2.4g
                ],
                frequency: 2,         // 1æ—¥2å›
                concentration: 0.05,  // 5%
                requiresAge: true     // å¹´é½¢å…¥åŠ›ãŒå¿…è¦
            },
            "claritin": {
                name: "ã‚¯ãƒ©ãƒªãƒãƒ³DS1%",
                type: "age-based",    // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤
                ageRanges: [
                    { minAge: 3, maxAge: 7, dailyDoseG: 0.5 },     // 3æ­³ä»¥ä¸Š7æ­³æœªæº€ï¼š1æ—¥0.5g
                    { minAge: 7, maxAge: 15, dailyDoseG: 1.0 }     // 7æ­³ä»¥ä¸Š15æ­³æœªæº€ï¼š1æ—¥1g
                ],
                frequency: 1,         // 1æ—¥1å›é£Ÿå¾Œ
                concentration: 0.01,  // 1%
                requiresAge: true     // å¹´é½¢å…¥åŠ›ãŒå¿…è¦
            },
            "levocetirizine": {
                name: "ãƒ¬ãƒœã‚»ãƒãƒªã‚¸ãƒ³DS0.5%",
                type: "age-based",    // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤
                ageRanges: [
                    { minAge: 0.5, maxAge: 1, dailyDoseG: 0.25, frequency: 1 },  // 0.5æ­³ä»¥ä¸Š1æ­³æœªæº€ï¼š1æ—¥0.25gï¼ˆ1æ—¥1å›ï¼‰
                    { minAge: 1, maxAge: 7, dailyDoseG: 0.5, frequency: 2 },     // 1æ­³ä»¥ä¸Š7æ­³æœªæº€ï¼š1æ—¥0.5gï¼ˆ1æ—¥2å›ï¼‰
                    { minAge: 7, maxAge: 15, dailyDoseG: 1.0, frequency: 2 }     // 7æ­³ä»¥ä¸Š15æ­³æœªæº€ï¼š1æ—¥1gï¼ˆ1æ—¥2å›ï¼‰
                ],
                concentration: 0.005, // 0.5%
                requiresAge: true     // å¹´é½¢å…¥åŠ›ãŒå¿…è¦
            },
            "zyrtec": {
                name: "ã‚¸ãƒ«ãƒ†ãƒƒã‚¯DS1.25%",
                type: "age-based",    // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤
                ageRanges: [
                    { minAge: 2, maxAge: 7, dailyDoseG: 0.4 },     // 2æ­³ä»¥ä¸Š7æ­³æœªæº€ï¼š1æ—¥0.4g
                    { minAge: 7, maxAge: 15, dailyDoseG: 0.8 }     // 7æ­³ä»¥ä¸Š15æ­³æœªæº€ï¼š1æ—¥0.8g
                ],
                frequency: 2,         // 1æ—¥2å›ï¼ˆæœé£Ÿå¾Œãƒ»å°±å¯å‰ï¼‰
                concentration: 0.0125, // 1.25%
                requiresAge: true     // å¹´é½¢å…¥åŠ›ãŒå¿…è¦
            },
            "asberin_powder": {
                name: "ã‚¢ã‚¹ãƒ™ãƒªãƒ³æ•£10%",
                type: "age-based",    // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤
                ageRanges: [
                    { minAge: 0, maxAge: 1, minDose: 0.05, maxDose: 0.2 },    // 1æ­³æœªæº€ï¼š0.05ï½0.2g
                    { minAge: 1, maxAge: 3, minDose: 0.1, maxDose: 0.25 },    // 1æ­³ä»¥ä¸Š3æ­³æœªæº€ï¼š0.1ï½0.25g
                    { minAge: 3, maxAge: 6, minDose: 0.15, maxDose: 0.4 }     // 3æ­³ä»¥ä¸Š6æ­³æœªæº€ï¼š0.15ï½0.4g
                ],
                frequency: 3,         // 1æ—¥3å›
                concentration: 0.1,   // 10%
                requiresAge: true     // å¹´é½¢å…¥åŠ›ãŒå¿…è¦
            },
            "asberin_ds": {
                name: "ã‚¢ã‚¹ãƒ™ãƒªãƒ³DS2%",
                type: "age-based",    // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤
                ageRanges: [
                    { minAge: 0, maxAge: 1, minDose: 0.25, maxDose: 1.0 },    // 1æ­³æœªæº€ï¼š0.25ï½1g
                    { minAge: 1, maxAge: 3, minDose: 0.5, maxDose: 1.25 },    // 1æ­³ä»¥ä¸Š3æ­³æœªæº€ï¼š0.5ï½1.25g
                    { minAge: 3, maxAge: 6, minDose: 0.75, maxDose: 2.0 }     // 3æ­³ä»¥ä¸Š6æ­³æœªæº€ï¼š0.75ï½2g
                ],
                frequency: 3,         // 1æ—¥3å›
                concentration: 0.02,  // 2%
                requiresAge: true     // å¹´é½¢å…¥åŠ›ãŒå¿…è¦
            },
            "asberin_syrup05": {
                name: "ã‚¢ã‚¹ãƒ™ãƒªãƒ³ã‚·ãƒ­ãƒƒãƒ—0.5%",
                type: "age-based",    // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤
                ageRanges: [
                    { minAge: 0, maxAge: 1, minDose: 1, maxDose: 4, unit: "mL" },    // 1æ­³æœªæº€ï¼š1ï½4mL
                    { minAge: 1, maxAge: 3, minDose: 2, maxDose: 5, unit: "mL" },    // 1æ­³ä»¥ä¸Š3æ­³æœªæº€ï¼š2ï½5mL
                    { minAge: 3, maxAge: 6, minDose: 3, maxDose: 8, unit: "mL" }     // 3æ­³ä»¥ä¸Š6æ­³æœªæº€ï¼š3ï½8mL
                ],
                frequency: 3,         // 1æ—¥3å›
                concentration: 0.005, // 0.5%
                requiresAge: true     // å¹´é½¢å…¥åŠ›ãŒå¿…è¦
            },
            "asberin_syrup2": {
                name: "ã‚¢ã‚¹ãƒ™ãƒªãƒ³ã‚·ãƒ­ãƒƒãƒ—ã€Œèª¿å‰¤ç”¨ã€2%",
                type: "age-based",    // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤
                ageRanges: [
                    { minAge: 0, maxAge: 1, minDose: 0.25, maxDose: 1.0, unit: "mL" },    // 1æ­³æœªæº€ï¼š0.25ï½1mL
                    { minAge: 1, maxAge: 3, minDose: 0.5, maxDose: 1.25, unit: "mL" },    // 1æ­³ä»¥ä¸Š3æ­³æœªæº€ï¼š0.5ï½1.25mL
                    { minAge: 3, maxAge: 6, minDose: 0.75, maxDose: 2.0, unit: "mL" }     // 3æ­³ä»¥ä¸Š6æ­³æœªæº€ï¼š0.75ï½2mL
                ],
                frequency: 3,         // 1æ—¥3å›
                concentration: 0.02,  // 2%
                requiresAge: true     // å¹´é½¢å…¥åŠ›ãŒå¿…è¦
            },
            "mucodyne": {
                name: "ãƒ ã‚³ãƒ€ã‚¤ãƒ³ã‚·ãƒ­ãƒƒãƒ—5%",
                dosePerKg: 0.6,       // 0.6mL/kg
                frequency: 3,         // 1æ—¥3å›
                concentration: 0.05,  // 5%
                unit: "mL"            // å˜ä½ã¯mL
            },
            "mucodyne_ds": {
                name: "ãƒ ã‚³ãƒ€ã‚¤ãƒ³DS50%",
                dosePerKgG: 0.06,     // 0.06g/kg
                frequency: 3,         // 1æ—¥3å›
                concentration: 0.5,   // 50%
                unit: "g"             // å˜ä½ã¯g
            },
            "mucosolvan_ds": {
                name: "å°å…ç”¨ãƒ ã‚³ã‚½ãƒ«ãƒãƒ³DS1.5%",
                dosePerKgG: 0.06,     // 0.06g/kg
                frequency: 3,         // 1æ—¥3å›
                concentration: 0.015, // 1.5%
                unit: "g"             // å˜ä½ã¯g
            },
            "mucosolvan_syrup": {
                name: "å°å…ç”¨ãƒ ã‚³ã‚½ãƒ«ãƒãƒ³ã‚·ãƒ­ãƒƒãƒ—0.3%",
                dosePerKg: 0.3,       // 0.3mL/kg
                frequency: 3,         // 1æ—¥3å›
                concentration: 0.003, // 0.3%
                unit: "mL"            // å˜ä½ã¯mL
            },
            "zaditen_ds": {
                name: "ã‚¶ã‚¸ãƒ†ãƒ³DS0.1%",
                dosePerKgG: 0.06,     // 0.06g/kg
                frequency: 2,         // 1æ—¥2å›
                concentration: 0.001, // 0.1%
                unit: "g",            // å˜ä½ã¯g
                dosageNote: "æœé£Ÿå¾Œãƒ»å°±å¯å‰",
                contraindication: "ç¦å¿Œï¼šã¦ã‚“ã‹ã‚“åˆã¯ãã®æ—¢å¾€æ­´ã®ã‚ã‚‹æ‚£è€…"
            },
            "zaditen_syrup": {
                name: "ã‚¶ã‚¸ãƒ†ãƒ³ã‚·ãƒ­ãƒƒãƒ—0.02%",
                dosePerKg: 0.3,       // 0.3mL/kg
                frequency: 2,         // 1æ—¥2å›
                concentration: 0.0002, // 0.02%
                unit: "mL",           // å˜ä½ã¯mL
                dosageNote: "æœé£Ÿå¾Œãƒ»å°±å¯å‰",
                contraindication: "ç¦å¿Œï¼šã¦ã‚“ã‹ã‚“åˆã¯ãã®æ—¢å¾€æ­´ã®ã‚ã‚‹æ‚£è€…"
            },
            "xyzal_syrup": {
                name: "ã‚¶ã‚¤ã‚¶ãƒ«ã‚·ãƒ­ãƒƒãƒ—0.05%",
                type: "age-based",    // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤
                ageRanges: [
                    { minAge: 0.5, maxAge: 1, dailyDoseML: 2.5, frequency: 1 },   // 0.5æ­³ä»¥ä¸Š1æ­³æœªæº€ï¼š2.5mLï¼ˆ1æ—¥1å›ï¼‰
                    { minAge: 1, maxAge: 7, dailyDoseML: 5.0, frequency: 2 },     // 1æ­³ä»¥ä¸Š7æ­³æœªæº€ï¼š5mLï¼ˆ1æ—¥2å›ï¼‰
                    { minAge: 7, maxAge: 15, dailyDoseML: 10.0, frequency: 2 }    // 7æ­³ä»¥ä¸Š15æ­³æœªæº€ï¼š10mLï¼ˆ1æ—¥2å›ï¼‰
                ],
                concentration: 0.0005, // 0.05%
                requiresAge: true,     // å¹´é½¢å…¥åŠ›ãŒå¿…è¦
                unit: "mL"            // å˜ä½ã¯mL
            },
            "meptin_ds": {
                name: "ãƒ¡ãƒ—ãƒãƒ³DS0.005%",
                type: "age-based-with-options", // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤ï¼ˆç”¨æ³•é¸æŠã‚ã‚Šï¼‰
                ageRanges: [
                    { 
                        minAge: 0, 
                        maxAge: 6, 
                        options: [
                            { dosePerKgG: 0.05, frequency: 2, dosageNote: "æœãƒ»å°±å¯å‰" },
                            { dosePerKgG: 0.075, frequency: 3, dosageNote: "æœãƒ»æ˜¼ãƒ»å°±å¯å‰" }
                        ]
                    },
                    { 
                        minAge: 6, 
                        maxAge: 15, 
                        options: [
                            { dailyDoseG: 0.5, frequency: 1, dosageNote: "å°±å¯å‰" },
                            { dailyDoseG: 1.0, frequency: 2, dosageNote: "æœãƒ»å°±å¯å‰" }
                        ]
                    }
                ],
                requiresAge: true,     // å¹´é½¢å…¥åŠ›ãŒå¿…è¦
                requiresOption: true,  // ç”¨æ³•é¸æŠãŒå¿…è¦
                unit: "g"             // å˜ä½ã¯g
            },
            "meptin_syrup": {
                name: "ãƒ¡ãƒ—ãƒãƒ³ã‚·ãƒ­ãƒƒãƒ—5Î¼g/mL",
                type: "age-based-with-options", // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤ï¼ˆç”¨æ³•é¸æŠã‚ã‚Šï¼‰
                ageRanges: [
                    { 
                        minAge: 0, 
                        maxAge: 6, 
                        options: [
                            { dosePerKg: 0.5, frequency: 2, dosageNote: "æœãƒ»å°±å¯å‰" },
                            { dosePerKg: 0.75, frequency: 3, dosageNote: "æœãƒ»æ˜¼ãƒ»å°±å¯å‰" }
                        ]
                    },
                    { 
                        minAge: 6, 
                        maxAge: 15, 
                        options: [
                            { dailyDoseML: 5, frequency: 1, dosageNote: "å°±å¯å‰" },
                            { dailyDoseML: 10, frequency: 2, dosageNote: "æœãƒ»å°±å¯å‰" }
                        ]
                    }
                ],
                requiresAge: true,     // å¹´é½¢å…¥åŠ›ãŒå¿…è¦
                requiresOption: true,  // ç”¨æ³•é¸æŠãŒå¿…è¦
                unit: "mL"            // å˜ä½ã¯mL
            },
            "kefral": {
                name: "ã‚±ãƒ•ãƒ©ãƒ¼ãƒ«ç´°ç²’å°å…ç”¨100mg",
                minDosePerKg: 20,    // mg/kg/æ—¥ (0.02g/kg = 20mg/kg)
                maxDosePerKg: 40,    // mg/kg/æ—¥ (0.04g/kg = 40mg/kg)
                frequency: 3,        // 1æ—¥3å›
                concentration: 0.1   // 100mg/g = 10%
            },
            "zithromax": {
                name: "ã‚¸ã‚¹ãƒ­ãƒãƒƒã‚¯ç´°ç²’å°å…ç”¨10%",
                minDosePerKg: 10,    // mg/kg/æ—¥ (0.01g/kg = 10mg/kg)
                maxDosePerKg: 10,    // mg/kg/æ—¥ (0.01g/kg = 10mg/kg)
                frequency: 1,        // 1æ—¥1å›
                concentration: 0.1,  // 10%
                dosageNote: "3æ—¥é–“æœç”¨"
            }
        };


        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
        function switchTab(tabName) {
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => content.classList.remove('active'));
            
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => button.classList.remove('active'));
            
            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã‚’è¡¨ç¤º
            document.getElementById(tabName).classList.add('active');
            
            // å¯¾å¿œã™ã‚‹ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
            const activeButton = document.querySelector(`[onclick="switchTab('${tabName}')"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }
            
            // çµæœã‚’éè¡¨ç¤ºã«ã™ã‚‹
            document.getElementById('result').style.display = 'none';
            document.getElementById('potencyResult').style.display = 'none';
        }

        // åŠ›ä¾¡è¨ˆç®—æ©Ÿèƒ½
        function calculatePotency() {
            const concentration = parseFloat(document.getElementById('concentration').value);
            const prescribedDose = parseFloat(document.getElementById('prescribedDose').value);
            const doseUnit = document.getElementById('doseUnit').value;
            const resultDiv = document.getElementById('potencyResult');
            
            // å…¥åŠ›ãƒã‚§ãƒƒã‚¯
            if (isNaN(concentration) || concentration <= 0) {
                alert('æ­£ã—ã„æ¿ƒåº¦ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ0ã‚ˆã‚Šå¤§ãã„æ•°å€¤ï¼‰');
                return;
            }
            
            if (isNaN(prescribedDose) || prescribedDose <= 0) {
                alert('æ­£ã—ã„ç”¨é‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ0ã‚ˆã‚Šå¤§ãã„æ•°å€¤ï¼‰');
                return;
            }
            
            // åŠ›ä¾¡è¨ˆç®—ï¼ˆå˜ä½ã«å¿œã˜ãŸè¨ˆç®—ï¼‰
            let weighAmount;
            let divisor;
            
            if (doseUnit === 'mg') {
                // mg ã®å ´åˆ: ç§¤å–é‡ï¼ˆ1æ—¥é‡ï¼‰= 100 Ã· è–¬å‰¤ã®æ¿ƒåº¦(%) Ã— å‡¦æ–¹ç®‹ã«è¨˜è¼‰ã®ç”¨é‡(mg) Ã· 1000
                weighAmount = (100 / concentration) * prescribedDose / 1000;
                divisor = '1000';
            } else if (doseUnit === 'Î¼g') {
                // Î¼g ã®å ´åˆ: ç§¤å–é‡ï¼ˆ1æ—¥é‡ï¼‰= 100 Ã· è–¬å‰¤ã®æ¿ƒåº¦(%) Ã— å‡¦æ–¹ç®‹ã«è¨˜è¼‰ã®ç”¨é‡(Î¼g) Ã· 1000000
                weighAmount = (100 / concentration) * prescribedDose / 1000000;
                divisor = '1000000';
            }
            
            // çµæœã‚’è¡¨ç¤º
            document.getElementById('resultConcentration').textContent = concentration.toFixed(2);
            document.getElementById('resultPrescribedDose').textContent = prescribedDose.toFixed(1);
            document.getElementById('resultDoseUnit').textContent = doseUnit;
            document.getElementById('resultWeighAmount').textContent = weighAmount.toFixed(2);
            
            // çµæœã‚’è¡¨ç¤º
            resultDiv.style.display = 'block';
        }

        // åŠ›ä¾¡è¨ˆç®—ã§ã®Enterã‚­ãƒ¼ã«ã‚ˆã‚‹æ¬¡ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¸ã®ç§»å‹•
        document.getElementById('concentration').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                document.getElementById('prescribedDose').focus();
            }
        });
        
        document.getElementById('prescribedDose').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                calculatePotency();
            }
        });

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('calculateBtn').addEventListener('click', calculateDose);
        document.getElementById('calculatePotencyBtn').addEventListener('click', calculatePotency);

        // ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã§ã‚‚è¨ˆç®—ã§ãã‚‹ã‚ˆã†ã«ï¼ˆãƒ•ã‚©ãƒ¼ãƒ å…¨ä½“ã§å‹•ä½œã™ã‚‹ã‚ˆã†ã«ä¿®æ­£ï¼‰
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                // åŠ›ä¾¡è¨ˆç®—ã®å€‹åˆ¥ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å ´åˆã¯å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
                const target = e.target;
                if (target.id === 'concentration' || target.id === 'prescribedDose') {
                    return; // å€‹åˆ¥ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã«ä»»ã›ã‚‹
                }
                
                e.preventDefault();
                
                // ç¾åœ¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã«å¿œã˜ã¦è¨ˆç®—ã‚’å®Ÿè¡Œ
                const activeDoseTab = document.getElementById('dose-calculator').classList.contains('active');
                const activePotencyTab = document.getElementById('potency-calculator').classList.contains('active');
                
                if (activeDoseTab) {
                    calculateDose();
                } else if (activePotencyTab) {
                    calculatePotency();
                }
            }
        });


        // è–¬å‰¤æ¤œç´¢æ©Ÿèƒ½
        const allMedicines = [
            {value: "asberin_powder", text: "ã‚¢ã‚¹ãƒ™ãƒªãƒ³æ•£10%"},
            {value: "asberin_ds", text: "ã‚¢ã‚¹ãƒ™ãƒªãƒ³DS2%"},
            {value: "asberin_syrup05", text: "ã‚¢ã‚¹ãƒ™ãƒªãƒ³ã‚·ãƒ­ãƒƒãƒ—0.5%"},
            {value: "asberin_syrup2", text: "ã‚¢ã‚¹ãƒ™ãƒªãƒ³ã‚·ãƒ­ãƒƒãƒ—ã€Œèª¿å‰¤ç”¨ã€2%"},
            {value: "acetaminophen", text: "ã‚¢ã‚»ãƒˆã‚¢ãƒŸãƒãƒ•ã‚§ãƒ³DS40%ã€Œä¸‰å’Œã€"},
            {value: "allelock", text: "ã‚¢ãƒ¬ãƒ­ãƒƒã‚¯é¡†ç²’0.5%"},
            {value: "erythro", text: "ã‚¨ãƒªã‚¹ãƒ­ã‚·ãƒ³DSW20%"},
            {value: "ozex", text: "ã‚ªã‚¼ãƒƒã‚¯ã‚¹ç´°ç²’å°å…ç”¨15%"},
            {value: "onon", text: "ã‚ªãƒãƒ³DS10%"},
            {value: "orapem", text: "ã‚ªãƒ©ãƒšãƒãƒ å°å…ç”¨ç´°ç²’10%"},
            {value: "carnal20", text: "ã‚«ãƒ­ãƒŠãƒ¼ãƒ«ç´°ç²’20%"},
            {value: "carnal50", text: "ã‚«ãƒ­ãƒŠãƒ¼ãƒ«ç´°ç²’50%"},
            {value: "kefral", text: "ã‚±ãƒ•ãƒ©ãƒ¼ãƒ«ç´°ç²’å°å…ç”¨100mg"},
            {value: "clarith", text: "ã‚¯ãƒ©ãƒªã‚¹DS10%å°å…ç”¨"},
            {value: "claritin", text: "ã‚¯ãƒ©ãƒªãƒãƒ³DS1%"},
            {value: "mucodyne", text: "ãƒ ã‚³ãƒ€ã‚¤ãƒ³ã‚·ãƒ­ãƒƒãƒ—5%"},
            {value: "mucodyne_ds", text: "ãƒ ã‚³ãƒ€ã‚¤ãƒ³DS50%"},
            {value: "mucosolvan_ds", text: "å°å…ç”¨ãƒ ã‚³ã‚½ãƒ«ãƒãƒ³DS1.5%"},
            {value: "mucosolvan_syrup", text: "å°å…ç”¨ãƒ ã‚³ã‚½ãƒ«ãƒãƒ³ã‚·ãƒ­ãƒƒãƒ—0.3%"},
            {value: "sawacillin", text: "ã‚µãƒ¯ã‚·ãƒªãƒ³ç´°ç²’10%"},
            {value: "zaditen_ds", text: "ã‚¶ã‚¸ãƒ†ãƒ³DS0.1%"},
            {value: "zaditen_syrup", text: "ã‚¶ã‚¸ãƒ†ãƒ³ã‚·ãƒ­ãƒƒãƒ—0.02%"},
            {value: "xyzal_syrup", text: "ã‚¶ã‚¤ã‚¶ãƒ«ã‚·ãƒ­ãƒƒãƒ—0.05%"},
            {value: "zyrtec", text: "ã‚¸ãƒ«ãƒ†ãƒƒã‚¯DS1.25%"},
            {value: "cefzon", text: "ã‚»ãƒ•ã‚¾ãƒ³ç´°ç²’å°å…ç”¨10%"},
            {value: "zithromax", text: "ã‚¸ã‚¹ãƒ­ãƒãƒƒã‚¯ç´°ç²’å°å…ç”¨10%"},
            {value: "zovirax", text: "ã‚¾ãƒ“ãƒ©ãƒƒã‚¯ã‚¹é¡†ç²’40%"},
            {value: "tamiflu", text: "ã‚¿ãƒŸãƒ•ãƒ«DS3%(å¹¼å°å…ã«é™ã‚‹)"},
            {value: "valtrex", text: "ãƒãƒ«ãƒˆãƒ¬ãƒƒã‚¯ã‚¹é¡†ç²’50%"},
            {value: "farom", text: "ãƒ•ã‚¡ãƒ­ãƒ DSå°å…ç”¨10%"},
            {value: "fexofenadine", text: "ãƒ•ã‚§ã‚­ã‚½ãƒ•ã‚§ãƒŠã‚¸ãƒ³å¡©é…¸å¡©DS5%"},
            {value: "flomox", text: "ãƒ•ãƒ­ãƒ¢ãƒƒã‚¯ã‚¹å°å…ç”¨ç´°ç²’10%"},
            {value: "fosmicin", text: "ãƒ›ã‚¹ãƒŸã‚·ãƒ³DS400"},
            {value: "meiact", text: "ãƒ¡ã‚¤ã‚¢ã‚¯ãƒˆMSå°å…ç”¨ç´°ç²’10%"},
            {value: "meptin_ds", text: "ãƒ¡ãƒ—ãƒãƒ³DS0.005%"},
            {value: "meptin_syrup", text: "ãƒ¡ãƒ—ãƒãƒ³ã‚·ãƒ­ãƒƒãƒ—5Î¼g/mL"},
            {value: "levocetirizine", text: "ãƒ¬ãƒœã‚»ãƒãƒªã‚¸ãƒ³DS0.5%"},
            {value: "widesillin", text: "ãƒ¯ã‚¤ãƒ‰ã‚·ãƒªãƒ³ç´°ç²’20%"}
        ];

        // ã²ã‚‰ãŒãªã‚’ã‚«ã‚¿ã‚«ãƒŠã«å¤‰æ›ã™ã‚‹é–¢æ•°
        function hiraganaToKatakana(str) {
            return str.replace(/[\u3041-\u3096]/g, function(match) {
                var chr = match.charCodeAt(0) + 0x60;
                return String.fromCharCode(chr);
            });
        }
        
        // ã‚«ã‚¿ã‚«ãƒŠã‚’ã²ã‚‰ãŒãªã«å¤‰æ›ã™ã‚‹é–¢æ•°
        function katakanaToHiragana(str) {
            return str.replace(/[\u30a1-\u30f6]/g, function(match) {
                var chr = match.charCodeAt(0) - 0x60;
                return String.fromCharCode(chr);
            });
        }

        let selectedIndex = -1;
        let currentOptions = [];

        // ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
        function updateClearButtonVisibility() {
            const searchInput = document.getElementById('medicineSearch');
            const container = searchInput.parentElement;
            if (searchInput.value.trim() !== '') {
                container.classList.add('has-text');
            } else {
                container.classList.remove('has-text');
            }
        }
        
        // éŸ³å£°èªè­˜ã®å¤‰æ•°
        let recognition = null;
        let isRecording = false;
        
        // éŸ³å£°èªè­˜ã®åˆæœŸåŒ–
        function initSpeechRecognition() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechRecognition();
                
                recognition.lang = 'ja-JP';
                recognition.continuous = false;
                recognition.interimResults = isMobile() ? true : false;  // ã‚¹ãƒãƒ›ã§ã¯ä¸­é–“çµæœè¡¨ç¤º
                recognition.maxAlternatives = 1;
                
                recognition.onstart = function() {
                    isRecording = true;
                    const voiceButton = document.getElementById('voiceSearchButton');
                    voiceButton.classList.add('recording');
                    voiceButton.title = 'éŒ²éŸ³ä¸­...';
                };
                
                recognition.onresult = function(event) {
                    const searchInput = document.getElementById('medicineSearch');
                    
                    // çµæœã®å­˜åœ¨ãƒã‚§ãƒƒã‚¯
                    if (!event.results || !event.results[0] || !event.results[0][0]) {
                        console.warn('éŸ³å£°èªè­˜çµæœãŒç©ºã§ã™');
                        return;
                    }
                    
                    // ã‚¹ãƒãƒ›ã§ã¯ä¸­é–“çµæœã‚‚è¡¨ç¤º
                    if (isMobile() && event.results[0].isFinal === false) {
                        const transcript = event.results[0][0].transcript;
                        if (transcript.trim()) {  // ç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯
                            searchInput.value = transcript + '...';
                            searchInput.style.color = '#999';  // ä¸­é–“çµæœã¯è–„ãè¡¨ç¤º
                        }
                        return;
                    }
                    
                    // æœ€çµ‚çµæœ
                    const result = event.results[0][0].transcript;
                    if (result.trim()) {  // ç©ºæ–‡å­—ãƒã‚§ãƒƒã‚¯
                        searchInput.value = result;
                        searchInput.style.color = '';  // é€šå¸¸è‰²ã«æˆ»ã™
                        
                        // æ¤œç´¢ã‚’å®Ÿè¡Œ
                        handleMedicineInput();
                    } else {
                        console.warn('éŸ³å£°èªè­˜çµæœãŒç©ºæ–‡å­—ã§ã™');
                        searchInput.style.color = '';  // è‰²ã‚’ãƒªã‚»ãƒƒãƒˆ
                    }
                };
                
                recognition.onerror = function(event) {
                    console.error('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼:', event.error);
                    stopRecording();
                    
                    if (event.error === 'not-allowed') {
                        alert('ãƒã‚¤ã‚¯ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ãŒå¿…è¦ã§ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨­å®šã§ãƒã‚¤ã‚¯ã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚');
                    } else if (event.error === 'no-speech') {
                        alert('éŸ³å£°ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');
                    } else {
                        alert('éŸ³å£°èªè­˜ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + event.error);
                    }
                };
                
                recognition.onend = function() {
                    stopRecording();
                };
                
                return true;
            }
            return false;
        }
        
        function stopRecording() {
            isRecording = false;
            const voiceButton = document.getElementById('voiceSearchButton');
            const searchInput = document.getElementById('medicineSearch');
            
            voiceButton.classList.remove('recording');
            voiceButton.title = 'éŸ³å£°å…¥åŠ›';
            
            // ä¸­é–“çµæœè¡¨ç¤ºä¸­ã®å ´åˆã€è‰²ã‚’ãƒªã‚»ãƒƒãƒˆ
            if (searchInput.style.color === 'rgb(153, 153, 153)' || searchInput.style.color === '#999') {
                searchInput.style.color = '';
            }
        }
        
        // éŸ³å£°å…¥åŠ›ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('voiceSearchButton').addEventListener('click', function() {
            if (!recognition) {
                const isSupported = initSpeechRecognition();
                if (!isSupported) {
                    alert('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚Chromeã€Edgeã€Safariã‚’ãŠä½¿ã„ãã ã•ã„ã€‚');
                    return;
                }
            }
            
            if (isRecording) {
                recognition.stop();
            } else {
                try {
                    recognition.start();
                } catch (error) {
                    console.error('éŸ³å£°èªè­˜é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);
                    alert('éŸ³å£°èªè­˜ã‚’é–‹å§‹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');
                }
            }
        });
        
        // ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        document.getElementById('clearMedicineSearch').addEventListener('click', function() {
            const searchInput = document.getElementById('medicineSearch');
            const medicineList = document.getElementById('medicineList');
            const selectedMedicine = document.getElementById('selectedMedicine');
            
            // å…¥åŠ›å†…å®¹ã‚’ã‚¯ãƒªã‚¢
            searchInput.value = '';
            selectedMedicine.value = '';
            
            // å€™è£œãƒªã‚¹ãƒˆã‚’éè¡¨ç¤º
            medicineList.style.display = 'none';
            currentOptions = [];
            selectedIndex = -1;
            
            // ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
            updateClearButtonVisibility();
            
            // å…¥åŠ›æ¬„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
            searchInput.focus();
            
            // è–¬å‰¤é¸æŠã®çŠ¶æ…‹ã‚’ãƒªã‚»ãƒƒãƒˆ
            triggerMedicineChange('');
        });
        
        let isComposing = false; // IMEå…¥åŠ›ä¸­ãƒ•ãƒ©ã‚°
        
        // ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒã‚¤ã‚¹æ¤œå‡º
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                   ('ontouchstart' in window) || 
                   (navigator.maxTouchPoints > 0);
        }
        
        // IMEå…¥åŠ›é–‹å§‹ãƒ»çµ‚äº†ã®æ¤œçŸ¥
        document.getElementById('medicineSearch').addEventListener('compositionstart', function() {
            isComposing = true;
        });
        
        document.getElementById('medicineSearch').addEventListener('compositionend', function() {
            isComposing = false;
            // IMEç¢ºå®šå¾Œã«æ¤œç´¢å‡¦ç†ã‚’å®Ÿè¡Œ
            setTimeout(() => {
                handleMedicineInput();
            }, 50);
        });
        
        document.getElementById('medicineSearch').addEventListener('input', function() {
            // è–¬å‰¤é¸æŠä¸­ã®å ´åˆã¯å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
            if (isSelectingMedicine) {
                return;
            }
            
            // IMEå…¥åŠ›ä¸­ã®å ´åˆã¯å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
            if (isComposing) {
                return;
            }
            
            // éŸ³å£°å…¥åŠ›ä¸­ã®å ´åˆã¯å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—
            if (isRecording) {
                return;
            }
            
            handleMedicineInput();
        });
        
        function handleMedicineInput() {
            const searchInput = document.getElementById('medicineSearch');
            let originalValue = searchInput.value;
            
            // æ¤œç´¢èªã¨ã—ã¦ä½¿ç”¨ã™ã‚‹å€¤ï¼ˆå¤‰æ›ã¯æ¤œç´¢æ™‚ã®ã¿è¡Œã„ã€å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯å¤‰æ›´ã—ãªã„ï¼‰
            let searchTerm = originalValue;
            const medicineList = document.getElementById('medicineList');
            selectedIndex = -1; // ãƒªã‚»ãƒƒãƒˆ
            
            // ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
            updateClearButtonVisibility();
            
            if (searchTerm === '') {
                medicineList.style.display = 'none';
                currentOptions = [];
                return;
            }
            
            // æ¤œç´¢æ¡ä»¶ã«åˆã†è–¬å‰¤ã‚’çµã‚Šè¾¼ã¿
            const filteredMedicines = allMedicines.filter(medicine => {
                const medicineText = medicine.text.toLowerCase();
                const searchTermLower = searchTerm.toLowerCase();
                
                // å…¥åŠ›ã•ã‚ŒãŸæ–‡å­—åˆ—ã‚’ãã®ã¾ã¾æ¤œç´¢
                if (medicineText.includes(searchTermLower)) {
                    return true;
                }
                
                // ã²ã‚‰ãŒãªã§å…¥åŠ›ã•ã‚ŒãŸå ´åˆã€ã‚«ã‚¿ã‚«ãƒŠã«å¤‰æ›ã—ã¦æ¤œç´¢
                const katakanaSearchTerm = hiraganaToKatakana(searchTermLower);
                if (medicineText.includes(katakanaSearchTerm.toLowerCase())) {
                    return true;
                }
                
                // ã‚«ã‚¿ã‚«ãƒŠã§å…¥åŠ›ã•ã‚ŒãŸå ´åˆã€ã²ã‚‰ãŒãªã«å¤‰æ›ã—ã¦æ¤œç´¢
                const hiraganaSearchTerm = katakanaToHiragana(searchTermLower);
                if (medicineText.includes(hiraganaSearchTerm.toLowerCase())) {
                    return true;
                }
                
                return false;
            });
            
            currentOptions = filteredMedicines;
            
            if (filteredMedicines.length === 0) {
                medicineList.innerHTML = '<div style="padding: 10px; color: #666;">è©²å½“ã™ã‚‹è–¬å‰¤ãŒã‚ã‚Šã¾ã›ã‚“</div>';
                medicineList.style.display = 'block';
                currentOptions = [];
                return;
            }
            
            // å€™è£œãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
            medicineList.innerHTML = filteredMedicines.map((medicine, index) => 
                `<div class="medicine-option" data-value="${medicine.value}" data-index="${index}" style="padding: 10px; cursor: pointer; border-bottom: 1px solid #eee;">${medicine.text}</div>`
            ).join('');
            
            medicineList.style.display = 'block';
            
            // å€™è£œé¸æŠæ™‚ã®å‡¦ç†ï¼ˆã‚¹ãƒãƒ›å¯¾å¿œï¼‰
            medicineList.querySelectorAll('.medicine-option').forEach(option => {
                // ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆå¯¾å¿œï¼ˆã‚¹ãƒãƒ›ç”¨ï¼‰
                option.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    selectMedicine(this);
                });
                
                // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç”¨ï¼‰
                option.addEventListener('click', function() {
                    selectMedicine(this);
                });
                
                option.addEventListener('mouseover', function() {
                    clearSelection();
                    this.style.backgroundColor = '#f0f0f0';
                });
                
                option.addEventListener('mouseout', function() {
                    if (!this.classList.contains('selected')) {
                        this.style.backgroundColor = '';
                    }
                });
            });
        }

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰æ“ä½œã®å‡¦ç†
        document.getElementById('medicineSearch').addEventListener('keydown', function(e) {
            const medicineList = document.getElementById('medicineList');
            const options = medicineList.querySelectorAll('.medicine-option');
            
            if (options.length === 0) return;
            
            switch(e.key) {
                case 'ArrowDown':
                    e.preventDefault();
                    selectedIndex = (selectedIndex + 1) % options.length;
                    updateSelection(options);
                    break;
                    
                case 'ArrowUp':
                    e.preventDefault();
                    selectedIndex = selectedIndex <= 0 ? options.length - 1 : selectedIndex - 1;
                    updateSelection(options);
                    break;
                    
                case 'Enter':
                    e.preventDefault();
                    if (selectedIndex >= 0 && options[selectedIndex]) {
                        selectMedicine(options[selectedIndex]);
                    } else {
                        // è–¬å‰¤ãŒæ—¢ã«é¸æŠã•ã‚Œã¦ã„ã‚‹å ´åˆã¯æ¬¡ã®å…¥åŠ›æ¬„ã¸
                        const selectedMedicine = document.getElementById('selectedMedicine').value;
                        if (selectedMedicine) {
                            // è–¬å‰¤ãŒé¸æŠæ¸ˆã¿ã®å ´åˆ
                            focusNextInput();
                        } else {
                            // è–¬å‰¤ãŒé¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆã§ã‚‚ã‚¹ãƒãƒ›ã§ã¯ä½“é‡å…¥åŠ›ã«ç§»å‹•
                            if (isMobile() && this.value.trim() !== '') {
                                setTimeout(() => {
                                    document.getElementById('weight').focus();
                                    document.getElementById('weight').click();
                                }, 100);
                            }
                        }
                    }
                    break;
                    
                case 'Escape':
                    medicineList.style.display = 'none';
                    selectedIndex = -1;
                    break;
            }
        });

        function updateSelection(options) {
            clearSelection();
            if (selectedIndex >= 0 && options[selectedIndex]) {
                options[selectedIndex].style.backgroundColor = '#e3f2fd';
                options[selectedIndex].classList.add('selected');
            }
        }

        function clearSelection() {
            const options = document.querySelectorAll('.medicine-option');
            options.forEach(option => {
                option.style.backgroundColor = '';
                option.classList.remove('selected');
            });
        }

        let isSelectingMedicine = false; // è–¬å‰¤é¸æŠä¸­ãƒ•ãƒ©ã‚°
        
        // æ¬¡ã®å…¥åŠ›æ¬„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’ç§»å‹•ã™ã‚‹é–¢æ•°ï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç”¨ï¼‰
        function focusNextInput() {
            const medicineId = document.getElementById('selectedMedicine').value;
            const medicine = medicines[medicineId];
            
            if (!medicine) return;
            
            // ã‚¹ãƒãƒ›ã®å ´åˆã¯è–¬å‰¤ã‚¿ã‚¤ãƒ—ã«é–¢ä¿‚ãªãã€è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹æ¬¡ã®å…¥åŠ›æ¬„ã«ç§»å‹•
            if (isMobile()) {
                setTimeout(() => {
                    // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤ã®å ´åˆã¯å¹´é½¢å…¥åŠ›ã«ç§»å‹•
                    if (medicine.type === 'age-based-with-options' || medicine.requiresAge) {
                        const ageInput = document.getElementById('age');
                        if (ageInput && ageInput.offsetParent !== null) {
                            ageInput.focus();
                            ageInput.click();
                            return;
                        }
                    }
                    // é©å¿œç—‡é¸æŠãŒå¿…è¦ãªè–¬å‰¤ã®å ´åˆ
                    if (medicine.hasIndication) {
                        const indicationInput = document.getElementById('indication');
                        if (indicationInput && indicationInput.offsetParent !== null) {
                            indicationInput.focus();
                            indicationInput.click();
                            return;
                        }
                    }
                    // é€šå¸¸ã®ä½“é‡ãƒ™ãƒ¼ã‚¹è–¬å‰¤ã®å ´åˆã€ã¾ãŸã¯ä»–ã®å…¥åŠ›æ¬„ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãªã„å ´åˆ
                    const weightInput = document.getElementById('weight');
                    if (weightInput && weightInput.offsetParent !== null) {
                        weightInput.focus();
                        weightInput.click();
                    }
                }, 100);
                return;
            }
            
            // ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã®å ´åˆã¯è–¬å‰¤ã‚¿ã‚¤ãƒ—åˆ¥ã«ç§»å‹•
            // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤ï¼ˆç”¨æ³•é¸æŠã‚ã‚Šï¼‰ã®å ´åˆ
            if (medicine.type === 'age-based-with-options') {
                document.getElementById('age').focus();
            } 
            // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤ã®å ´åˆ
            else if (medicine.requiresAge) {
                document.getElementById('age').focus();
            } 
            // é©å¿œç—‡é¸æŠãŒå¿…è¦ãªè–¬å‰¤ã®å ´åˆ
            else if (medicine.hasIndication) {
                document.getElementById('indication').focus();
            } 
            // é€šå¸¸ã®ä½“é‡ãƒ™ãƒ¼ã‚¹è–¬å‰¤ã®å ´åˆ
            else {
                document.getElementById('weight').focus();
            }
        }
        
        function selectMedicine(optionElement) {
            const value = optionElement.getAttribute('data-value');
            const text = optionElement.textContent.trim();
            
            // è–¬å‰¤é¸æŠä¸­ãƒ•ãƒ©ã‚°ã‚’è¨­å®š
            isSelectingMedicine = true;
            
            // å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç›´æ¥å€™è£œã®è–¬å‰¤åã«è¨­å®š
            const searchInput = document.getElementById('medicineSearch');
            searchInput.value = text;
            document.getElementById('selectedMedicine').value = value;
            document.getElementById('medicineList').style.display = 'none';
            selectedIndex = -1;
            currentOptions = [];
            
            // ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³ã®è¡¨ç¤ºåˆ¶å¾¡
            updateClearButtonVisibility();
            
            // è–¬å‰¤é¸æŠã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«
            triggerMedicineChange(value);
            
            // ãƒ•ãƒ©ã‚°ã‚’ãƒªã‚»ãƒƒãƒˆ
            setTimeout(() => {
                isSelectingMedicine = false;
                // ã‚¹ãƒãƒ›ã®å ´åˆã¯ã‚¿ãƒƒãƒé¸æŠå¾Œã«ä½“é‡å…¥åŠ›æ¬„ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
                if (isMobile()) {
                    setTimeout(() => {
                        const weightInput = document.getElementById('weight');
                        weightInput.focus();
                        // ã‚¹ãƒãƒ›ã§ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’ç¢ºå®Ÿã«è¡¨ç¤º
                        weightInput.click();
                    }, 300);
                }
            }, 100);
        }
        
        // è–¬å‰¤é¸æŠæ™‚ã®å‡¦ç†ã‚’é–¢æ•°åŒ–
        function triggerMedicineChange(medicineId) {
            const indicationGroup = document.getElementById('indicationGroup');
            const weightGroup = document.getElementById('weightGroup');
            const ageGroup = document.getElementById('ageGroup');
            const weightGroupForAge = document.getElementById('weightGroupForAge');
            const dosageOptionGroup = document.getElementById('dosageOptionGroup');
            const indicationSelect = document.getElementById('indication');
            const dosageOptionSelect = document.getElementById('dosageOption');
            
            // å…¥åŠ›æ¬„ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('weight').value = '';
            document.getElementById('weightForAge').value = '';
            document.getElementById('age').value = '';
            indicationSelect.value = '';
            dosageOptionSelect.value = '';
            
            // çµæœã‚’éè¡¨ç¤º
            document.getElementById('result').style.display = 'none';
            
            // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤ï¼ˆç”¨æ³•é¸æŠã‚ã‚Šï¼‰ã®å ´åˆ
            if (medicineId && medicines[medicineId]?.type === 'age-based-with-options') {
                indicationGroup.style.display = 'none';
                weightGroup.style.display = 'none';
                ageGroup.style.display = 'block';
                weightGroupForAge.style.display = 'none'; // å¹´é½¢å…¥åŠ›å¾Œã«è¡¨ç¤º
                dosageOptionGroup.style.display = 'none'; // å¹´é½¢å…¥åŠ›å¾Œã«è¡¨ç¤º
            } else if (medicineId && medicines[medicineId]?.requiresAge) {
                // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤ã®å ´åˆ
                indicationGroup.style.display = 'none';
                weightGroup.style.display = 'none';
                ageGroup.style.display = 'block';
                weightGroupForAge.style.display = 'none';
                dosageOptionGroup.style.display = 'none';
            } else if (medicineId && medicines[medicineId]?.hasIndication) {
                // é©å¿œç—‡é¸æŠãŒå¿…è¦ãªè–¬å‰¤ã®å ´åˆ
                indicationGroup.style.display = 'block';
                weightGroup.style.display = 'none';
                ageGroup.style.display = 'none';
                weightGroupForAge.style.display = 'none';
                dosageOptionGroup.style.display = 'none';
            } else {
                // é€šå¸¸ã®ä½“é‡ãƒ™ãƒ¼ã‚¹è–¬å‰¤ã®å ´åˆ
                indicationGroup.style.display = 'none';
                weightGroup.style.display = 'block';
                ageGroup.style.display = 'none';
                weightGroupForAge.style.display = 'none';
                dosageOptionGroup.style.display = 'none';
            }
        }

        
        // é©å¿œç—‡é¸æŠæ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        document.getElementById('indication').addEventListener('change', function() {
            // é©å¿œç—‡ãŒé¸æŠã•ã‚ŒãŸã‚‰ä½“é‡å…¥åŠ›æ¬„ã‚’è¡¨ç¤º
            if (this.value) {
                document.getElementById('weightGroup').style.display = 'block';
            } else {
                document.getElementById('weightGroup').style.display = 'none';
            }
        });

        // å¹´é½¢å…¥åŠ›æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ï¼ˆãƒ¡ãƒ—ãƒãƒ³ç”¨ï¼‰
        document.getElementById('age').addEventListener('input', function() {
            const medicineId = document.getElementById('selectedMedicine').value;
            const medicine = medicines[medicineId];
            const dosageOptionGroup = document.getElementById('dosageOptionGroup');
            const dosageOptionSelect = document.getElementById('dosageOption');
            
            if (medicine?.type === 'age-based-with-options' && this.value) {
                const age = parseFloat(this.value);
                if (!isNaN(age) && age >= 0) {
                    // å¹´é½¢ã«è©²å½“ã™ã‚‹é¸æŠè‚¢ã‚’æ¤œç´¢
                    let matchedRange = null;
                    for (const range of medicine.ageRanges) {
                        if (age >= range.minAge && age < range.maxAge) {
                            matchedRange = range;
                            break;
                        }
                    }
                    
                    if (matchedRange) {
                        // ç”¨æ³•é¸æŠè‚¢ã‚’ç”Ÿæˆ
                        dosageOptionSelect.innerHTML = '<option value="">-- ç”¨æ³•ã‚’é¸æŠ --</option>';
                        matchedRange.options.forEach((option, index) => {
                            const optionText = `1æ—¥${option.frequency}å›ï¼ˆ${option.dosageNote}ï¼‰`;
                            dosageOptionSelect.innerHTML += `<option value="${index}">${optionText}</option>`;
                        });
                        dosageOptionGroup.style.display = 'block';
                        
                        // 0-6æ­³æœªæº€ã®å ´åˆã¯ä½“é‡å…¥åŠ›ã‚‚å¿…è¦
                        if (age < 6) {
                            document.getElementById('weightGroupForAge').style.display = 'block';
                        } else {
                            document.getElementById('weightGroupForAge').style.display = 'none';
                        }
                    } else {
                        dosageOptionGroup.style.display = 'none';
                        document.getElementById('weightGroupForAge').style.display = 'none';
                    }
                } else {
                    dosageOptionGroup.style.display = 'none';
                    document.getElementById('weightGroupForAge').style.display = 'none';
                }
            } else {
                dosageOptionGroup.style.display = 'none';
                document.getElementById('weightGroupForAge').style.display = 'none';
            }
        });

        // ç¦å¿Œæƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹é–¢æ•°
        function showContraindicationInfo(medicine) {
            const contraindicationDiv = document.getElementById('contraindicationInfo');
            const contraindicationText = document.getElementById('contraindicationText');
            
            if (medicine.contraindication) {
                contraindicationText.textContent = medicine.contraindication;
                contraindicationDiv.style.display = 'block';
            } else {
                contraindicationDiv.style.display = 'none';
            }
        }

        // æŠ•ä¸é‡ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
        function calculateDose() {
            const medicineId = document.getElementById('selectedMedicine').value;
            const resultDiv = document.getElementById('result');
            const medicine = JSON.parse(JSON.stringify(medicines[medicineId])); // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼
            
            // å…¥åŠ›ãƒã‚§ãƒƒã‚¯
            if (!medicineId) {
                alert('è–¬å‰¤ã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            // å¹´é½¢ãƒ™ãƒ¼ã‚¹è–¬å‰¤ï¼ˆç”¨æ³•é¸æŠã‚ã‚Šï¼‰ã®å ´åˆ
            if (medicine?.type === 'age-based-with-options') {
                const ageInput = document.getElementById('age').value;
                const age = parseFloat(ageInput);
                const dosageOptionIndex = document.getElementById('dosageOption').value;
                
                if (isNaN(age) || age <= 0) {
                    alert('æ­£ã—ã„å¹´é½¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ0ã‚ˆã‚Šå¤§ãã„æ•°å€¤ï¼‰');
                    return;
                }
                
                if (dosageOptionIndex === '') {
                    alert('ç”¨æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„');
                    return;
                }
                
                // å¹´é½¢ã«è©²å½“ã™ã‚‹ç”¨é‡ã‚’æ¤œç´¢
                let matchedRange = null;
                for (const range of medicine.ageRanges) {
                    if (age >= range.minAge && age < range.maxAge) {
                        matchedRange = range;
                        break;
                    }
                }
                
                if (!matchedRange) {
                    alert(`${age}æ­³ã¯å¯¾è±¡å¹´é½¢å¤–ã§ã™`);
                    return;
                }
                
                const selectedOption = matchedRange.options[parseInt(dosageOptionIndex)];
                if (!selectedOption) {
                    alert('é¸æŠã—ãŸç”¨æ³•ãŒç„¡åŠ¹ã§ã™');
                    return;
                }
                
                let dailyDose, singleDose, unit;
                
                // ä½“é‡ãƒ™ãƒ¼ã‚¹ã®è¨ˆç®—ï¼ˆ0-6æ­³æœªæº€ï¼‰
                if (selectedOption.dosePerKgG || selectedOption.dosePerKg) {
                    const weightInput = document.getElementById('weightForAge').value;
                    const weight = parseFloat(weightInput);
                    
                    if (isNaN(weight) || weight <= 0) {
                        alert('æ­£ã—ã„ä½“é‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ0ã‚ˆã‚Šå¤§ãã„æ•°å€¤ï¼‰');
                        document.getElementById('weightGroupForAge').style.display = 'block';
                        return;
                    }
                    
                    if (selectedOption.dosePerKgG) {
                        // gå˜ä½ã®è¨ˆç®—
                        dailyDose = selectedOption.dosePerKgG * weight;
                        unit = 'g';
                    } else {
                        // mLå˜ä½ã®è¨ˆç®—
                        dailyDose = selectedOption.dosePerKg * weight;
                        unit = 'mL';
                    }
                } else {
                    // å›ºå®šç”¨é‡ï¼ˆ6æ­³ä»¥ä¸Šï¼‰
                    if (selectedOption.dailyDoseG) {
                        dailyDose = selectedOption.dailyDoseG;
                        unit = 'g';
                    } else {
                        dailyDose = selectedOption.dailyDoseML;
                        unit = 'mL';
                    }
                }
                
                singleDose = dailyDose / selectedOption.frequency;
                
                // çµæœã‚’è¡¨ç¤º
                document.getElementById('resultDose').innerHTML = `${dailyDose.toFixed(2)} ${unit}`;
                document.getElementById('resultSingleDose').innerHTML = `${singleDose.toFixed(2)} ${unit}`;
                document.getElementById('resultMedicine').textContent = medicine.name;
                document.getElementById('dosageInfo').textContent = `1æ—¥${selectedOption.frequency}å›ï¼ˆ${selectedOption.dosageNote}ï¼‰`;
                
                // ç¦å¿Œæƒ…å ±ã‚’è¡¨ç¤º
                showContraindicationInfo(medicine);
                
                // çµæœã‚’è¡¨ç¤º
                resultDiv.style.display = 'block';
                return;
            } else if (medicine?.requiresAge) {
                const ageInput = document.getElementById('age').value;
                const age = parseFloat(ageInput);
                
                if (isNaN(age) || age <= 0) {
                    alert('æ­£ã—ã„å¹´é½¢ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ0ã‚ˆã‚Šå¤§ãã„æ•°å€¤ï¼‰');
                    return;
                }
                
                // å¹´é½¢ã«è©²å½“ã™ã‚‹ç”¨é‡ã‚’æ¤œç´¢
                let matchedRange = null;
                for (const range of medicine.ageRanges) {
                    if (age >= range.minAge && age < range.maxAge) {
                        matchedRange = range;
                        break;
                    }
                }
                
                if (!matchedRange) {
                    alert(`${age}æ­³ã¯å¯¾è±¡å¹´é½¢å¤–ã§ã™`);
                    return;
                }
                
                // å¹´é½¢ãƒ™ãƒ¼ã‚¹ã®è¨ˆç®—
                let dailyDoseG, singleDoseG, frequency;
                
                // ã‚¶ã‚¤ã‚¶ãƒ«ã‚·ãƒ­ãƒƒãƒ—ï¼ˆmLå›ºå®šç”¨é‡ï¼‰ã®å ´åˆ
                if (matchedRange.dailyDoseML) {
                    const dailyDoseML = matchedRange.dailyDoseML;
                    frequency = matchedRange.frequency;
                    const singleDoseML = dailyDoseML / frequency;
                    
                    // çµæœã‚’è¡¨ç¤ºï¼ˆmLå˜ä½ï¼‰
                    document.getElementById('resultDose').innerHTML = `${dailyDoseML.toFixed(1)} mL`;
                    document.getElementById('resultSingleDose').innerHTML = `${singleDoseML.toFixed(1)} mL`;
                    document.getElementById('resultMedicine').textContent = medicine.name;
                    
                    // ã‚¶ã‚¤ã‚¶ãƒ«ã‚·ãƒ­ãƒƒãƒ—ã®ç”¨æ³•è¡¨ç¤º
                    if (frequency === 1) {
                        document.getElementById('dosageInfo').textContent = `1æ—¥${frequency}å›`;
                    } else {
                        document.getElementById('dosageInfo').textContent = `1æ—¥${frequency}å›ï¼ˆæœé£Ÿå¾Œãƒ»å°±å¯å‰ï¼‰`;
                    }
                    
                    // ç¦å¿Œæƒ…å ±ã‚’è¡¨ç¤º
                    showContraindicationInfo(medicine);
                    
                    // çµæœã‚’è¡¨ç¤º
                    resultDiv.style.display = 'block';
                    return;
                } else if (matchedRange.minDose && matchedRange.maxDose) {
                    // ã‚¢ã‚¹ãƒ™ãƒªãƒ³ç³»è–¬å‰¤ï¼ˆç¯„å›²æŒ‡å®šï¼‰ã®å ´åˆ
                    frequency = medicine.frequency;
                    const minDose = matchedRange.minDose;
                    const maxDose = matchedRange.maxDose;
                    const unit = matchedRange.unit || "g";
                    
                    // çµæœã‚’è¡¨ç¤º
                    document.getElementById('resultDose').innerHTML = `${minDose} - ${maxDose} ${unit}`;
                    document.getElementById('resultSingleDose').innerHTML = `${(minDose/frequency).toFixed(2)} - ${(maxDose/frequency).toFixed(2)} ${unit}`;
                    document.getElementById('resultMedicine').textContent = medicine.name;
                    document.getElementById('dosageInfo').textContent = `1æ—¥${frequency}å›`;
                    
                    // ç¦å¿Œæƒ…å ±ã‚’è¡¨ç¤º
                    showContraindicationInfo(medicine);
                    
                    // çµæœã‚’è¡¨ç¤º
                    resultDiv.style.display = 'block';
                    return;
                } else {
                    // å¾“æ¥ã®å›ºå®šç”¨é‡è–¬å‰¤
                    dailyDoseG = matchedRange.dailyDoseG;
                    // ãƒ¬ãƒœã‚»ãƒãƒªã‚¸ãƒ³ã¯å¹´é½¢ç¯„å›²ã”ã¨ã«æŠ•ä¸å›æ•°ãŒç•°ãªã‚‹
                    frequency = matchedRange.frequency || medicine.frequency;
                    singleDoseG = dailyDoseG / frequency;
                }
                
                // çµæœã‚’è¡¨ç¤º
                document.getElementById('resultDose').innerHTML = `${dailyDoseG.toFixed(2)} g`;
                document.getElementById('resultSingleDose').innerHTML = `${singleDoseG.toFixed(2)} g`;
                document.getElementById('resultMedicine').textContent = medicine.name;
                // è–¬å‰¤ã”ã¨ã«ç”¨æ³•ã‚’è¨­å®š
                if (medicineId === 'allelock') {
                    document.getElementById('dosageInfo').textContent = `1æ—¥${frequency}å›ï¼ˆæœãƒ»å°±å¯å‰ï¼‰`;
                } else if (medicineId === 'claritin') {
                    document.getElementById('dosageInfo').textContent = `1æ—¥${frequency}å›ï¼ˆé£Ÿå¾Œï¼‰`;
                } else if (medicineId === 'levocetirizine') {
                    if (frequency === 1) {
                        document.getElementById('dosageInfo').textContent = `1æ—¥${frequency}å›`;
                    } else {
                        document.getElementById('dosageInfo').textContent = `1æ—¥${frequency}å›ï¼ˆæœé£Ÿå¾Œãƒ»å°±å¯å‰ï¼‰`;
                    }
                } else if (medicineId === 'zyrtec') {
                    document.getElementById('dosageInfo').textContent = `1æ—¥${frequency}å›ï¼ˆæœé£Ÿå¾Œãƒ»å°±å¯å‰ï¼‰`;
                } else {
                    document.getElementById('dosageInfo').textContent = `1æ—¥${frequency}å›`;
                }
                
                // ç¦å¿Œæƒ…å ±ã‚’è¡¨ç¤º
                showContraindicationInfo(medicine);
                
                // çµæœã‚’è¡¨ç¤º
                resultDiv.style.display = 'block';
                return;
            }
            
            // ä½“é‡ãƒ™ãƒ¼ã‚¹è–¬å‰¤ã®å ´åˆï¼ˆæ—¢å­˜å‡¦ç†ï¼‰
            const weightInput = document.getElementById('weight').value;
            const weight = parseFloat(weightInput);
            
            if (isNaN(weight) || weight <= 0) {
                alert('æ­£ã—ã„ä½“é‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆ0ã‚ˆã‚Šå¤§ãã„æ•°å€¤ï¼‰');
                return;
            }
            
            let dailyDoseMg, singleDoseMg, dailyDoseG, singleDoseG;
            
            // é©å¿œç—‡ã«å¿œã˜ã¦æŠ•ä¸é‡ã‚’è¨­å®š
            if (medicineId === 'zovirax' || medicineId === 'valtrex') {
                const indication = document.getElementById('indication').value;
                if (medicineId === 'zovirax') {
                    if (indication === 'herpesSimplex') {
                        // å˜ç´”ç–±ç–¹ã®å ´åˆï¼ˆã‚¾ãƒ“ãƒ©ãƒƒã‚¯ã‚¹ï¼‰
                        // 10kgæœªæº€: 80mg/kg/æ—¥ã€10kgä»¥ä¸Š: 2.0g/æ—¥
                        medicine.minDosePerKg = 80;  // 80mg/kg/æ—¥
                        medicine.maxDosePerKg = 80;  // 80mg/kg/æ—¥
                        medicine.frequency = 4;      // 1æ—¥4å›
                        medicine.maxDailyDoseG = 2.0; // 1æ—¥æœ€å¤§2g
                        medicine.maxWeightForDose = 10; // 10kgä»¥ä¸Šã¯2.0g/æ—¥ã§å›ºå®š
                    } else if (indication === 'herpesZoster') {
                        // å¸¯çŠ¶ç–±ç–¹ã®å ´åˆï¼ˆã‚¾ãƒ“ãƒ©ãƒƒã‚¯ã‚¹ï¼‰
                        medicine.minDosePerKg = 80;  // 80mg/kg/æ—¥
                        medicine.maxDosePerKg = 80;  // 80mg/kg/æ—¥
                        medicine.frequency = 5;      // 1æ—¥5å›
                    }
                } else if (medicineId === 'valtrex') {
                    if (indication === 'herpesSimplex') {
                        // å˜ç´”ç–±ç–¹ã®å ´åˆï¼ˆãƒãƒ«ãƒˆãƒ¬ãƒƒã‚¯ã‚¹ï¼‰
                        // 20kgæœªæº€: 50mg/kg/æ—¥ã€20kgä»¥ä¸Š: 2.0g/æ—¥
                        medicine.minDosePerKg = 50;  // 50mg/kg/æ—¥
                        medicine.maxDosePerKg = 50;  // 50mg/kg/æ—¥
                        medicine.frequency = 2;      // 1æ—¥2å›
                        medicine.maxDailyDoseG = 2.0; // 1æ—¥æœ€å¤§2g
                        medicine.maxWeightForDose = 20; // 20kgä»¥ä¸Šã¯2.0g/æ—¥ã§å›ºå®š
                    } else if (indication === 'herpesZoster') {
                        // å¸¯çŠ¶ç–±ç–¹ã®å ´åˆï¼ˆãƒãƒ«ãƒˆãƒ¬ãƒƒã‚¯ã‚¹ï¼‰
                        // 40kgæœªæº€: 75mg/kg/æ—¥ã€40kgä»¥ä¸Š: 6.0g/æ—¥
                        medicine.minDosePerKg = 75;  // 75mg/kg/æ—¥
                        medicine.maxDosePerKg = 75;  // 75mg/kg/æ—¥
                        medicine.frequency = 3;      // 1æ—¥3å›
                        medicine.maxDailyDoseG = 6.0; // 1æ—¥æœ€å¤§6g
                        medicine.maxWeightForDose = 40; // 40kgä»¥ä¸Šã¯6.0g/æ—¥ã§å›ºå®š
                        
                        // 40kgä»¥ä¸Šã®å ´åˆã¯å¸¸ã«6.0g/æ—¥ï¼ˆ1å›2.0gÃ—3å›ï¼‰ã«è¨­å®š
                        if (weight >= 40) {
                            // ç›´æ¥çµæœã‚’è¨­å®š
                            document.getElementById('resultDose').innerHTML = '6.00 g';
                            document.getElementById('resultSingleDose').innerHTML = '2.00 g';
                            // è¨ˆç®—ã‚’ã‚¹ã‚­ãƒƒãƒ—
                            return;
                        }
                    }
                }
            }
            
            // 1æ—¥é‡ã‚’è¨ˆç®—
            if (medicine.dailyDosePerKg) {
                // 1æ—¥é‡ãƒ™ãƒ¼ã‚¹ã®è¨ˆç®—ï¼ˆã‚¿ãƒŸãƒ•ãƒ«ãªã©ï¼‰
                let dailyDoseG = medicine.dailyDosePerKg * weight;  // 1æ—¥é‡ï¼ˆgï¼‰
                
                // æœ€å¤§æŠ•ä¸é‡ã®ãƒã‚§ãƒƒã‚¯
                if (medicine.maxDailyDose && dailyDoseG > medicine.maxDailyDose) {
                    dailyDoseG = medicine.maxDailyDose;
                }
                
                const singleDoseG = dailyDoseG / medicine.frequency;  // 1å›é‡ï¼ˆgï¼‰
                
                // çµæœã‚’è¡¨ç¤º
                document.getElementById('resultDose').innerHTML = `${dailyDoseG.toFixed(3)} g`;
                document.getElementById('resultSingleDose').innerHTML = `${singleDoseG.toFixed(3)} g`;
                document.getElementById('dosageInfo').textContent = `1æ—¥${medicine.frequency}å›`;
            } else if (medicine.dailyDoseMultiplier) {
                // 1æ—¥é‡ = ä¹—æ•° Ã— ä½“é‡(kg)
                dailyDoseG = medicine.dailyDoseMultiplier * weight;
                singleDoseG = dailyDoseG / medicine.frequency;
                
                // çµæœã‚’è¡¨ç¤º
                document.getElementById('resultDose').innerHTML = `${dailyDoseG.toFixed(2)} g`;
                document.getElementById('resultSingleDose').innerHTML = `${singleDoseG.toFixed(2)} g`;
                
            } else if (medicine.dailyDoseMg) {
                // 1æ—¥é‡ãŒç›´æ¥æŒ‡å®šã•ã‚Œã¦ã„ã‚‹å ´åˆ
                dailyDoseMg = medicine.dailyDoseMg;
                singleDoseMg = dailyDoseMg / medicine.frequency;
                
                // gã«å¤‰æ›ï¼ˆå«æœ‰ç‡ã‚’è€ƒæ…®ï¼‰
                dailyDoseG = (dailyDoseMg / 1000) / medicine.concentration;
                singleDoseG = (singleDoseMg / 1000) / medicine.concentration;
                
                // çµæœã‚’è¡¨ç¤ºï¼ˆç›´æ¥æŒ‡å®šï¼‰
                document.getElementById('resultDose').innerHTML = `${dailyDoseG.toFixed(2)} g`;
                document.getElementById('resultSingleDose').innerHTML = `${singleDoseG.toFixed(2)} g`;
            } else if (medicine.dosePerKg && medicine.unit === "mL") {
                // mLå˜ä½ã§ã®è¨ˆç®—ï¼ˆãƒ ã‚³ãƒ€ã‚¤ãƒ³ã‚·ãƒ­ãƒƒãƒ—ãªã©ï¼‰
                const dailyDoseML = medicine.dosePerKg * weight;  // 1æ—¥é‡ï¼ˆmLï¼‰
                const singleDoseML = dailyDoseML / medicine.frequency;  // 1å›é‡ï¼ˆmLï¼‰
                
                // çµæœã‚’è¡¨ç¤ºï¼ˆmLå˜ä½ï¼‰
                document.getElementById('resultDose').innerHTML = `${dailyDoseML.toFixed(2)} mL`;
                document.getElementById('resultSingleDose').innerHTML = `${singleDoseML.toFixed(2)} mL`;
                document.getElementById('resultMedicine').textContent = medicine.name;
                
                // ã‚¶ã‚¸ãƒ†ãƒ³ã‚·ãƒ­ãƒƒãƒ—ã®å ´åˆã¯ç‰¹åˆ¥ãªç”¨æ³•è¡¨ç¤º
                if (medicineId === 'zaditen_syrup') {
                    document.getElementById('dosageInfo').textContent = `1æ—¥${medicine.frequency}å›ï¼ˆæœé£Ÿå¾Œãƒ»å°±å¯å‰ï¼‰`;
                } else {
                    document.getElementById('dosageInfo').textContent = `1æ—¥${medicine.frequency}å›`;
                }
                
                // ç¦å¿Œæƒ…å ±ã‚’è¡¨ç¤º
                showContraindicationInfo(medicine);
                
                // çµæœã‚’è¡¨ç¤º
                resultDiv.style.display = 'block';
                return;
            } else if (medicine.dosePerKgG && medicine.unit === "g") {
                // gå˜ä½ã§ã®ç›´æ¥è¨ˆç®—ï¼ˆãƒ ã‚³ãƒ€ã‚¤ãƒ³DSãªã©ï¼‰
                const dailyDoseG = medicine.dosePerKgG * weight;  // 1æ—¥é‡ï¼ˆgï¼‰
                const singleDoseG = dailyDoseG / medicine.frequency;  // 1å›é‡ï¼ˆgï¼‰
                
                // çµæœã‚’è¡¨ç¤ºï¼ˆgå˜ä½ï¼‰
                document.getElementById('resultDose').innerHTML = `${dailyDoseG.toFixed(2)} g`;
                document.getElementById('resultSingleDose').innerHTML = `${singleDoseG.toFixed(2)} g`;
                document.getElementById('resultMedicine').textContent = medicine.name;
                
                // ã‚¶ã‚¸ãƒ†ãƒ³DSã®å ´åˆã¯ç‰¹åˆ¥ãªç”¨æ³•è¡¨ç¤º
                if (medicineId === 'zaditen_ds') {
                    document.getElementById('dosageInfo').textContent = `1æ—¥${medicine.frequency}å›ï¼ˆæœé£Ÿå¾Œãƒ»å°±å¯å‰ï¼‰`;
                } else {
                    document.getElementById('dosageInfo').textContent = `1æ—¥${medicine.frequency}å›`;
                }
                
                // ç¦å¿Œæƒ…å ±ã‚’è¡¨ç¤º
                showContraindicationInfo(medicine);
                
                // çµæœã‚’è¡¨ç¤º
                resultDiv.style.display = 'block';
                return;
            } else if (medicine.minDosePerKg === medicine.maxDosePerKg) {
                // 1æ—¥é‡ã«å¹…ãŒãªã„å ´åˆï¼ˆå˜ä¸€å€¤ï¼‰
                dailyDoseMg = medicine.minDosePerKg * weight;
                
                // gã«å¤‰æ›ï¼ˆå«æœ‰ç‡ã‚’è€ƒæ…®ï¼‰
                dailyDoseG = (dailyDoseMg / 1000) / medicine.concentration;
                singleDoseG = (dailyDoseMg / 1000 / medicine.frequency) / medicine.concentration;
                
                // 1æ—¥é‡ã®ä¸Šé™ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆã‚ªãƒãƒ³DS10%ãªã©ï¼‰
                if (medicineId === 'onon') {
                    const maxDailyDoseG = 4.5;  // 1æ—¥é‡ã®æœ€å¤§å€¤ 4.5g
                    if (dailyDoseG > maxDailyDoseG) {
                        dailyDoseG = maxDailyDoseG;
                        singleDoseG = dailyDoseG / medicine.frequency;
                    }
                }
                
                // 1æ—¥é‡ã®ä¸Šé™ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆã‚¾ãƒ“ãƒ©ãƒƒã‚¯ã‚¹ã¾ãŸã¯ãƒãƒ«ãƒˆãƒ¬ãƒƒã‚¯ã‚¹ã§å˜ç´”ç–±ç–¹ã®å ´åˆï¼‰
                if ((medicineId === 'zovirax' || medicineId === 'valtrex') && 
                    document.getElementById('indication').value === 'herpesSimplex' &&
                    medicine.maxDailyDoseG) {
                    
                    // ãƒãƒ«ãƒˆãƒ¬ãƒƒã‚¯ã‚¹ã¾ãŸã¯ã‚¾ãƒ“ãƒ©ãƒƒã‚¯ã‚¹ã§ã€ä½“é‡ãŒé–¾å€¤ä»¥ä¸Šã®å ´åˆã€1æ—¥é‡ã‚’å›ºå®šå€¤ã«è¨­å®š
                    if ((medicineId === 'valtrex' && weight >= (medicine.maxWeightForDose || 0)) ||
                        (medicineId === 'zovirax' && weight >= (medicine.maxWeightForDose || 0))) {
                        dailyDoseG = medicine.maxDailyDoseG;
                    } else if (medicine.maxDailyDoseG) {
                        // ãã‚Œä»¥å¤–ã¯é€šå¸¸é€šã‚Šä¸Šé™ãƒã‚§ãƒƒã‚¯
                        dailyDoseG = Math.min(dailyDoseG, medicine.maxDailyDoseG);
                    }
                    singleDoseG = dailyDoseG / medicine.frequency;
                }
                
                // çµæœã‚’è¡¨ç¤ºï¼ˆå˜ä¸€å€¤ï¼‰
                document.getElementById('resultDose').innerHTML = `${dailyDoseG.toFixed(2)} g`;
                document.getElementById('resultSingleDose').innerHTML = `${singleDoseG.toFixed(2)} g`;
            } else {
                // 1æ—¥é‡ã«å¹…ãŒã‚ã‚‹å ´åˆ
                const minDailyDoseMg = medicine.minDosePerKg * weight;
                const maxDailyDoseMg = medicine.maxDosePerKg * weight;
                const minSingleDoseMg = minDailyDoseMg / medicine.frequency;
                const maxSingleDoseMg = maxDailyDoseMg / medicine.frequency;
                
                // gã«å¤‰æ›ï¼ˆå«æœ‰ç‡ã‚’è€ƒæ…®ï¼‰
                let minDailyDoseG = (minDailyDoseMg / 1000) / medicine.concentration;
                let maxDailyDoseG = (maxDailyDoseMg / 1000) / medicine.concentration;
                let minSingleDoseG = (minSingleDoseMg / 1000) / medicine.concentration;
                let maxSingleDoseG = (maxSingleDoseMg / 1000) / medicine.concentration;
                
                // 1æ—¥é‡ã®ä¸Šé™ã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆã‚ªãƒãƒ³DS10%ãªã©ï¼‰
                if (medicineId === 'onon' && medicine.maxDailyDose) {
                    const maxDailyDoseG_limit = medicine.maxDailyDose;  // 1æ—¥é‡ã®æœ€å¤§å€¤ 4.5g
                    if (maxDailyDoseG > maxDailyDoseG_limit) {
                        maxDailyDoseG = maxDailyDoseG_limit;
                        maxSingleDoseG = maxDailyDoseG / medicine.frequency;
                    }
                }
                
                // çµæœã‚’è¡¨ç¤ºï¼ˆç¯„å›²ï¼‰
                document.getElementById('resultDose').innerHTML = 
                    `${minDailyDoseG.toFixed(2)} - ${maxDailyDoseG.toFixed(2)} g`;
                document.getElementById('resultSingleDose').innerHTML = 
                    `${minSingleDoseG.toFixed(2)} - ${maxSingleDoseG.toFixed(2)} g`;
            }
            
            // è–¬å‰¤åã¨ç”¨æ³•ã‚’è¡¨ç¤º
            document.getElementById('resultMedicine').textContent = medicine.name;
            
            // ã‚¶ã‚¸ãƒ†ãƒ³ã®å ´åˆã¯ç‰¹åˆ¥ãªç”¨æ³•è¡¨ç¤º
            if (medicineId === 'zaditen_ds' || medicineId === 'zaditen_syrup') {
                document.getElementById('dosageInfo').textContent = `1æ—¥${medicine.frequency}å›ï¼ˆæœé£Ÿå¾Œãƒ»å°±å¯å‰ï¼‰`;
            } else {
                document.getElementById('dosageInfo').textContent = `1æ—¥${medicine.frequency}å›`;
            }
            
            // ã‚«ãƒ­ãƒŠãƒ¼ãƒ«ç´°ç²’20%ã®å ´åˆã¯è¿½è¨˜
            if (medicineId === 'carnal20') {
                document.getElementById('dosageInfo').textContent = `1æ—¥${medicine.frequency}å›ï¼ˆ1æ—¥æœ€å¤§0.3g/kgï¼‰`;
            }
            
            // ã‚«ãƒ­ãƒŠãƒ¼ãƒ«ç´°ç²’50%ã®å ´åˆã¯è¿½è¨˜
            if (medicineId === 'carnal50') {
                document.getElementById('dosageInfo').textContent = `1æ—¥${medicine.frequency}å›ï¼ˆ1æ—¥æœ€å¤§0.12g/kgï¼‰`;
            }
            
            // ã‚¢ã‚»ãƒˆã‚¢ãƒŸãƒãƒ•ã‚§ãƒ³DS40%ã®å ´åˆã¯è¿½è¨˜
            if (medicineId === 'acetaminophen') {
                document.getElementById('dosageInfo').textContent = `1æ—¥${medicine.frequency}å›ï¼ˆ1æ—¥æœ€å¤§0.15g/kgï¼‰`;
            }
            
            // ã‚¸ã‚¹ãƒ­ãƒãƒƒã‚¯ç´°ç²’å°å…ç”¨10%ã®å ´åˆã¯è¿½è¨˜
            if (medicineId === 'zithromax') {
                document.getElementById('dosageInfo').textContent = `1æ—¥${medicine.frequency}å›ï¼ˆ${medicine.dosageNote}ï¼‰`;
            }
            
            // ç¦å¿Œæƒ…å ±ã‚’è¡¨ç¤º
            showContraindicationInfo(medicine);
            
            // çµæœã‚’è¡¨ç¤º
            resultDiv.style.display = 'block';
        }
    </script>
    
    <!-- ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼ç™»éŒ² -->
    <script src="register-sw.js"></script>
</body>
</html>
